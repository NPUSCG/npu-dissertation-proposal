%% File: npu-report-style.tex (西北工业大学研究生学位论文选题报告表)
%% Date: 2018/01/20
%% Author: Yang Zongze  (yangzongze@gmail.com)
%%
%% 使用说明
%% 1. 使用 `article' 类, 并使用 \input{npu-report-style.tex} 加载该文件。
%% 2. 设置论文相关信息(参考 npu-report-sample.tex)
%%       \nputitle{-开题报告题目-}
%%       \npunumber{-学号-}
%%       \npuschool{-学院-}
%%       \npumajor{-专业-}
%%       \npuname{-姓名-}
%%       \npudegree{-学位-}
%%       \npusupervisor{-导师-}
%%       \nputype{-培养类别-}
%%       \npudate{-日期-}
%%       %% 设置 `论文类型': 取消或添加注释即可勾选相应类型
%%       \npucheckbasetrue       %  基础研究
%%       \npucheckapplytrue     %  应用研究
%%       % \npucheckenginetrue    %  工程技术
%%       % \npucheckoveralltrue   %  跨学科研究

\usepackage{xeCJK}
\usepackage{calc}
\usepackage[heading=true]{ctex}
\usepackage{lipsum}
\usepackage{zhlipsum}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{geometry}
\usepackage{fancybox}
\usepackage{filecontents}
\usepackage[breakable,skins]{tcolorbox}

\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amsfonts}

\geometry{paperwidth=210mm,paperheight=297mm,%
  left=2.5cm,right=2.5cm,top=2.54cm,bottom=2.54cm}

\newtcolorbox{ttcbox}[1][]{%
  breakable,height fixed for=first and middle, 
  sharp corners=all,boxrule=1pt,colframe=black,colback=white, #1}

\newtcolorbox{ttcbtab}[1][]{%
  left=0mm,right=0mm,top=0mm,bottom=0mm,boxsep=0mm,
  left skip=-5mm, right skip=-5mm,
  sharp corners=all,boxrule=0pt,colframe=black,colback=white, #1}

\newcommand\paperspace[1]{\par\vskip #1\textheight}
\newcommand\paperbreak{\par\vskip\textheight minus\textheight \pagebreak}

\newcolumntype{C}{>{\hfil}X<{\hfil}}
\pagestyle{plain}

\ifx\ctexset\undefined
  \CTEXsetup[format={\zihao{4}\bfseries}]{section}
  \CTEXsetup[format={\zihao{-4}\bfseries}]{subsection}
\else
  \ctexset{%
    section={%
      format={\zihao{4}\bfseries},
      beforeskip=5pt,
      afterskip=5pt
    }}
  \ctexset{%
    subsection={%
      format={\zihao{-4}\bfseries},
      beforeskip=5pt,
      afterskip=0pt
    }}
  \ctexset{%
    subsubsection={%
      format={\zihao{5}\bfseries},
      beforeskip=3pt,
      afterskip=0pt
    }}
\fi

\def\npunumberingall{%
  \let\npusection\section%
  \def\npustarsection##1{\npusection{##1}}%
  \def\section{\secdef\npusection\npustarsection}%
}

\newif\ifnpucomments\npucommentsfalse

\newif\ifnpucheckbase\npucheckbasefalse
\newif\ifnpucheckapply\npucheckapplyfalse
\newif\ifnpucheckengine\npucheckenginefalse
\newif\ifnpucheckoverall\npucheckoverallfalse

\def\npunew#1#2{%
  \expandafter\def\csname npuinner#1\endcsname{#2}
  \expandafter\def\csname npu#1\endcsname##1{%
    \expandafter\def\csname npuinner#1\endcsname{##1}}}
\npunew{title}{<开题报告题目>}
\npunew{number}{<学号>}
\npunew{school}{<学院>}
\npunew{major}{<专业>}
\npunew{name}{<姓名>}
\npunew{degree}{<学位>}
\npunew{supervisor}{<导师>}
\npunew{type}{<培养类别>}
\npunew{date}{<日期>}
\def\maketitlepage{
  \thisfancypage{}{}
  \begin{titlepage}
    \linespread{1.25}
    \begin{center}
      \newlength{\npunolenght}
      \newlength{\nputmplenght}
      \newcommand\npucu[1]{\uline{\hfill ##1 \hfill}}
      \newcommand\npumb[2][\nputmplenght]{\makebox[##1][s]{##2}}
      \newcommand\npucoveritem[2]{\npumb[\nputmplenght]{##1}\npucu{##2}\newline}
      %\zihao{-4}
      %\settowidth{\npunolenght}{20002010000000}
      %\hfill 学号: \npumb[\npunolenght]{\npucu{\npuinnernumber}}
      \vspace*{3.5cm}
      {\bf\yahei\zihao{1}\noindent \makebox[8cm][s]{西北工业大学}}\par
      \vskip 1.5cm
      {\bf\yahei\zihao{1}\noindent 研究生学位论文选题报告表}\par
      \yahei
      \vskip 0pt plus 5fil
      \zihao{4}
      攻读学位级别：\hspace*{1em} $\surd$\  博士 \hspace*{1em}  $\square$\  硕士
      \vskip 2cm
      \zihao{-3}
      \settowidth{\nputmplenght}{学科、专业}
      \begin{minipage}{9.5cm}\linespread{1.8}\selectfont
        \noindent
        \npucoveritem{学院}{\npuinnerschool}
        \npucoveritem{姓名}{\npuinnername} 
        \npucoveritem{学号}{\npuinnernumber} 
        \npucoveritem{学科、专业}{\npuinnermajor}
        % \npucoveritem{学位级别}{\npuinnerdegree}
        \npucoveritem{指导教师}{\npuinnersupervisor}
        % \npucoveritem{培养\hfil 类别}{\npuinnertype}
        \npucoveritem{填表日期}{\npuinnerdate}
      \end{minipage}
      \vskip 0pt plus 5fil\zihao{3}
      \heiti\zihao{3}
      \makebox[8cm][c]{西北工业大学研究生院}
    \end{center}
  \end{titlepage}
  \clearpage}

\def\makeinnerpage{
  \thisfancypage{}{}
  \begin{center}
    \bf\yahei\zihao{-2}  研究生学位论文选题报告的要求
  \end{center}\vskip1cm
  \newcounter{npulc}{%
  \kaishu\zihao{4}
  \begin{list}{\chinese{npulc}、}{%
    \settowidth\labelwidth{一、}\usecounter{npulc}}
  \item 硕士生的开题报告内容应包括文献综述、选题意义、研究内容、研究方案，论文工作量的估计、工作条件，预期达到的水平，存在的问题及拟采取的解决措施。
  \item 博士生的开题报告内容应包括文献综述、选题背景及其意义、研究内容、研究特色、工作难点、预期成果及其可能的创新点。
  \item 正式开题之前，研究生应在广泛阅读中、外文资料的基础上，深入了解拟选课题的国内外研究动态，把握所选课题的目的、意义和预期结果，明确课题工作的设想、方法和研究路径。
  \item 博士生在规定的时间内，写出开题报告初稿，经指导教师审阅同意后，进行开题报告的送审。开题报告评审未通过者，修后重新送审，若第二次送审仍通不过者，则按有关规定终止学籍。
  \item 不能按期申请开题评议者，应及时向学院提出延期申请。
  \item 本表若不够填写时，可另加附页。
  \end{list}}
  \clearpage}

\linespread{1.25}
\def\makehead{
  \begin{ttcbox}[lower separated=false, space to upper, segmentation style={draw=black, solid}]
    \begin{ttcbtab}[frame empty, before={\vskip -3mm}]
      \renewcommand\arraystretch{1.5}
      \begin{tabularx}{\textwidth}{>{\centering}X|C|C|C|C}
        \bf 论文题目 & \multicolumn{4}{c}{\npuinnertitle} \\ \hline
        \bf 开题次数 & \multicolumn{4}{c}{
          $\surd$第一次\hspace*{2cm} $\square$第二次
        } \\ \hline
        \multirow{2}*{\parbox{0.18\textwidth}{%
         \centering\bf 论文类型\\(请在有关项目\\下作$\surd$记号)}} %
        & 基础研究 & 应用研究 & 工程技术 & 跨学科研究 \\ \cline{2-5}
        & \ifnpucheckbase $\surd$ \fi   & \ifnpucheckapply $\surd$ \fi  
        & \ifnpucheckengine $\surd$ \fi & \ifnpucheckoverall $\surd$\fi \\\hline
      \end{tabularx}
    \end{ttcbtab}
}

\newlength{\npucone}
\setlength{\npucone}{2.2cm}
\newlength{\npuctwo}
\setlength{\npuctwo}{\textwidth}
\addtolength{\npuctwo}{-\npucone}
\newcommand\npubox[2][3cm]{\parbox[c]{#1}{\centering #2}}
\newcommand\npuitem[2][3cm]{\parbox[c][#1][c]{\npucone}{\centering #2}}
\newcommand\npusig[3][2.5cm]{\parbox[c][#1][c]{\npuctwo}{%
  #3 \vskip 0pt plus15fil \hskip2cm #2
  \hskip 0pt plus15fil \quad 年 \quad 月 \quad 日 {\color{white}哈}}}

\def\maketail{
  \ifnpucomments
    \tcblower
    \begin{ttcbtab}[frame empty, enlarge bottom finally by=-4mm]
      \setlength{\tabcolsep}{0pt}
      \begin{tabularx}{\textwidth}{c|X}\hline
        \npuitem[4.5cm]{指导教师\\意\qquad 见} & 
        \npusig[4.5cm]{\hskip0.38\npuctwo 指导教师（签名）:
                       \vskip 0pt \hskip2cm 
                      {\color{white} 院系负责人（签名）:}}%
                      {{\bf\songti\ 请导师明确说明论文选题是否涉密:}} \\\hline
        \npuitem[3.5cm]{院\quad 系\\意\quad 见} & 
        \npusig[3.5cm]{院系负责人（签名）:}{}               \\\hline
        \npuitem[]{研究生院\\复核时间}          & 
        \npusig{复核人签名（签章）:}{}                      \\\hline
        \npuitem[2.5cm]{备注}                   &           \\
      \end{tabularx}
    \end{ttcbtab}
  \else
    \tcblower
    \begin{ttcbtab}[frame empty, enlarge bottom finally by=-4mm]
      \setlength{\tabcolsep}{0pt}
      \begin{tabularx}{\textwidth}{c|X}\hline
        \npuitem[1.3cm]{\bf\songti\zihao{-4} 备注}                   &           \\
      \end{tabularx}
    \end{ttcbtab}
  \fi
  \end{ttcbox}
}

\AtBeginDocument{\maketitlepage\makeinnerpage\makehead}
\AtEndDocument{\maketail}
\renewcommand{\normalsize}{\zihao{-4}}
\pagestyle{plain}

\newtheorem{theorem}{定理}
\newtheorem{lemma}[theorem]{引理}
\newtheorem{corollary}[theorem]{推论}
\newtheorem{proposition}[theorem]{命题}
% \theoremstyle{definition}
\newtheorem{definition}[theorem]{定义}
\renewcommand\refname{\zihao{5}\rm 参考文献}
\newcommand*{\fakebreak}{\par\vspace{\textheight minus \textheight}\pagebreak}
% \linespread{1.5}
\ctexset{autoindent=false}
\setlength\parindent{2em}
\endinput

